---
aliases: 
tags:
  - cpp
  - point
created: 2024-08-31 17:00
updated: 2024-09-01 17:20
title: æ™ºèƒ½æŒ‡é’ˆ
---

> [!TIP] TIPğŸ’¡ 
>  å…³äºæ™ºèƒ½æŒ‡é’ˆä¸­çš„åŸºç¡€çŸ¥è¯†å¯ä»¥çœ‹ä¸€ä¸‹ [[å¯¹è±¡ç”Ÿå­˜å‘¨æœŸ]]
# æ™ºèƒ½æŒ‡é’ˆ unique_ptr
`unique_ptr` æ˜¯ä½œç”¨åŸŸæŒ‡é’ˆï¼Œè¶…è¿‡ä½œç”¨åŸŸæ—¶ä¼šè¿›è¡Œé”€æ¯ï¼Œåœ¨ [[å¯¹è±¡ç”Ÿå­˜å‘¨æœŸ]]ä¸­æåŠçš„ä½œç”¨åŸŸæŒ‡é’ˆå…¶å®å°±æ˜¯ unique_ptrã€‚
Unique_ptr æŒ‡é’ˆä»å­—é¢æ„æ€ç†è§£å°±æ˜¯æŒ‡è¯¥æŒ‡é’ˆæ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè€Œäº‹å®ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ã€‚**unique_ptræŒ‡é’ˆä¸èƒ½å¤åˆ¶**ï¼Œå› ä¸ºå¤åˆ¶ä¹‹åä¸¤è€…æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆå…³é—­æ—¶ï¼Œä¼šé”€æ¯æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œå¯¼è‡´ä¸¤è€…æŒ‡å‘å·²å›æ”¶çš„å†…å­˜ã€‚
```cpp
#include<memory>
class Entity
{
public:
    Entity()
    {
        std::cout << "åˆ›å»ºå¯¹è±¡" << std::endl;
    }
    ~Entity()
    {
        std::cout << "é”€æ¯å¯¹è±¡" << std::endl;
    }
    void print() {}
};

int main()
{
    {
        std::unique_ptr<Entity> entity(new Entity());
        //ä½¿ç”¨make_uniqueåˆ›å»ºunique_pträ¼šæ›´åŠ å®‰å…¨
        //å¯é¿å…æ„é€ å‡½æ•°å¼‚å¸¸æ—¶å˜æˆæ²¡æœ‰å¼•ç”¨çš„æ‚¬ç©ºæŒ‡é’ˆ
        std::unique_ptr<Entity> entity = std::make_unique<Entity>();
		//ä¸‹åˆ—åšæ³•æ˜¯é”™è¯¯çš„
		std::unique_ptr<Entity> e0 = entity;    
        entity->print();
    }
}
```
# æ™ºèƒ½æŒ‡é’ˆ shared_ptr
`Shared_ptr` ç›¸æ¯” unique_ptrï¼Œå¯ä»¥ä»å­—é¢æ„æ€ä¸Šçœ‹å‡º shared_ptr å¯ä»¥å…±äº«ï¼ˆå¤åˆ¶ï¼‰ã€‚Shared_ptr é€šè¿‡å¼•ç”¨è®¡æ•°æ¥å†³å®šæ˜¯å¦é”€æ¯ï¼Œå¦‚æœæ²¡æœ‰å¯¹è±¡å¼•ç”¨è¯¥æŒ‡é’ˆï¼Œå³å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼ŒæŒ‡é’ˆå°†ä¼šè‡ªåŠ¨é”€æ¯ã€‚

```cpp
#include<memory>
class Entity
{
public:
    Entity()
    {
        std::cout << "åˆ›å»ºå¯¹è±¡" << std::endl;
    }
    ~Entity()
    {
        std::cout << "é”€æ¯å¯¹è±¡" << std::endl;
    }
    void print() {}
};

int main()
{
	//ä¾‹å­1
    {
        std::shared_ptr<Entity> entity(new Entity());
		//shared_ptréœ€è¦åˆ†é…é¢å¤–å†…å­˜ç»™æ§åˆ¶å—ï¼Œè®°å½•å¼•ç”¨è®¡æ•°
		//ä½¿ç”¨make_sharedå¯ä»¥æ›´é«˜æ•ˆåœ°åˆ†é…å†…å­˜
        std::shared_ptr<Entity> entity = std::make_shared<Entity>();
		//shared_ptrå¯ä»¥è¿›è¡Œå¤åˆ¶
		std::shared_ptr<Entity> e0 = entity;
    }

	//ä¾‹å­2
	{
		std::shared_ptr<Entity> e0;
		{
			//æ­¤æ—¶å¼•ç”¨è®¡æ•°å˜ä¸º1
			std::shared_ptr<Entity> shared_entity = std::make_shared<Entity>();
			//å¼•ç”¨è®¡æ•°å˜ä¸º2
			e0 = shared_entity;
		}//ç¦»å¼€shared_entityçš„ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å˜ä¸º1
	}//ç¦»å¼€e0çš„ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œentityå¯¹è±¡é”€æ¯

	{
		//weak_pträ¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°
		std::weak_ptr<Entity> e0;
	    {
	  		//æ­¤æ—¶å¼•ç”¨è®¡æ•°å˜ä¸º1
	  		std::shared_ptr<Entity> shared_entity = std::make_shared<Entity>();
	  		//å¼•ç”¨è®¡æ•°ä»ç„¶ä¸º1
	  		e0 = shared_entity;
	  	}
	  	//ç¦»å¼€shared_entityçš„ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œé”€æ¯entityå¯¹è±¡
	  	//e0æŒ‡å‘ä¸€ä¸ªæ— æ•ˆçš„Entityå¯¹è±¡
	}
}
```
Weak_ptr æŒ‡é’ˆä¸ shared_ptr å”¯ä¸€çš„åŒºåˆ«åœ¨äºä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¯¹äºå¯¹è±¡çš„æœ‰æ•ˆæ€§å’Œæ‰€å±æƒå¹¶ä¸å…³å¿ƒçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ weak_ptr æŒ‡é’ˆï¼Œ**weak_ptr å¯ä»¥æŒ‡å‘å­˜æ´»çš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸èƒ½ä¿æ´»**ã€‚
> [!comment] Comment 
>  æ™ºèƒ½æŒ‡é’ˆå¯ä»¥æœ‰æ•ˆåœ°è‡ªåŠ¨åŒ–ç®¡ç†å†…å­˜ï¼Œå¦‚æœåœ¨ä»£ç ä¸­ä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ delete ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å…¶ä¸­ shared_ptr ç›¸æ¯” unique_ptr ï¼Œæœ‰é¢å¤–çš„å¼•ç”¨è®¡æ•°ï¼Œå› æ­¤æœ‰ç€æ›´é«˜çš„ç³»ç»Ÿå¼€é”€ï¼Œæ‰€ä»¥åœ¨**ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ—¶åº”ä¼˜å…ˆè€ƒè™‘ unique_ptr**ï¼Œå¦‚æœå­˜åœ¨å¯¹è±¡é—´å…±äº«çš„éœ€æ±‚ï¼Œå†è€ƒè™‘ shared_ptrã€‚
